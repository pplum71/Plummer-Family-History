<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin · Plummer Family History</title>
  <meta name="description" content="A multipage family history site for preserving stories, photos, and the family tree." />
  <link rel="stylesheet" href="./assets/style.css" />
</head>
<body>
  
    <nav class="nav">
      <div class="nav-inner nav">
        <div class="brand">
          <img src="./assets/logo.png" alt="Plummer Crest" style="height:28px;width:auto" />
          <span>Plummer Family History</span>
        </div>
        <ul class="nav">
          <li><a href="index.html" >Home</a></li>
          <li><a href="family-tree.html" >Family Tree</a></li>
          <li><a href="stories.html" >Stories</a></li>
          <li><a href="photos.html" >Photos</a></li>
          <li><a href="contact.html" >Contact</a></li>
          </ul>
      </div>
    </nav>
    
  <script>
    function adminGate(secretKey) {
        const query = new URLSearchParams(window.location.search);
        const key = query.get('key');
        const content = document.getElementById('admin-content');
        const locked = document.getElementById('admin-locked');
        
        if (!key || key !== secretKey) {
            if (content) content.style.display = 'none';
            if (locked) locked.classList.remove('hidden');
        } else {
            if (content) content.style.display = 'block';
            if (locked) locked.classList.add('hidden');
        }
    }
  </script>

<main class="container">
  <h1>Admin</h1>
  <div id="admin-locked" class="alert hidden">This page is locked. Append <code>?key=YOURSECRET</code> to the URL (replace with your secret).</div>
  <div id="admin-content">
    
    <p class="alert-info alert" id="firebase-status">Initializing Firestore...</p>

    <hr/>
    <h3 id="tree-embed">Interactive Tree Embed</h3>
    <p class="small">Edit the HTML shown on the Family Tree page under “Interactive Tree (Embed)”. You can paste D3 scripts, an SVG, or an <code>&lt;iframe&gt;</code> to another viewer.</p>
    <textarea id="te_editor" class="input" rows="10" placeholder="Paste your embed HTML here"></textarea>
    <div class="cta">
      <button id="te_load" class="button">Load current embed</button>
      <button id="te_save_local" class="button">Save draft (local)</button>
      <button id="te_commit" class="button">Commit tree-embed.html to GitHub</button>
      <button id="te_reset" class="button">Reset to placeholder</button>
    </div>
    <script>
      const TE_KEY = 'treeEmbedDraft';
      function te_save(){ localStorage.setItem(TE_KEY, document.getElementById('te_editor').value); }
      function te_loadLocal(){ return localStorage.getItem(TE_KEY) || ''; }
      async function te_loadRemote(){
        const t = await fetch('./data/tree-embed.html', {cache:'no-store'}).then(r=> r.ok ? r.text() : '');
        document.getElementById('te_editor').value = t;
      }
      document.getElementById('te_load').addEventListener('click', te_loadRemote);
      document.getElementById('te_save_local').addEventListener('click', ()=>{ te_save(); alert('Draft saved in this browser.'); });
      document.getElementById('te_reset').addEventListener('click', ()=>{
        document.getElementById('te_editor').value = '<div class="figure">Add your interactive tree here (D3, SVG, or an embedded viewer).</div>';
      });
      // The old te_commit function using gh_commitFile is removed as we focus on Firestore now.
      document.getElementById('te_commit').addEventListener('click', ()=>{
          alert('Note: File commits (like tree-embed.html) still rely on GitHub settings. People Manager now uses Firestore.');
      });
      // Prefill with local draft or remote on first load
      window.addEventListener('DOMContentLoaded', async ()=>{
        const draft = te_loadLocal();
        if(draft){ document.getElementById('te_editor').value = draft; }
        else { try{ await te_loadRemote(); }catch(_){} }
      });
    </script>

    <hr/>
    <h3 id="people-manager">People Manager (Firestore Enabled)</h3>
    <p class="small">IDs must be unique (e.g., <code>john-gordon-plummer-1890</code>). Parents/Spouses: comma-separated IDs.</p><p class="small"><a class="button" href="./people.html" target="_blank" rel="noreferrer">Open public People page</a></p>
    <p class="small">**All changes are saved directly to Firestore** (in your private space) and reflected instantly on the public pages.</p>
    
    <div class="row">
      <input id="pm_name" class="input" placeholder="Full name (required)"/>
      <input id="pm_summary" class="input" placeholder="One-line summary (e.g., 'Teacher, loved music')"/>
    </div>
    
    <div class="row">
      <input id="pm_id" class="input" placeholder="ID (auto from name if blank)"/>
      <input id="pm_parents" class="input" placeholder="Parents (IDs, comma-separated)"/>
      <input id="pm_spouses" class="input" placeholder="Spouses (IDs, comma-separated)"/>
    </div>
    
    <div class="row" style="margin-top:10px">
        <label style="width:100%;font-size:0.8em;opacity:0.8;margin-bottom: -10px;">Birth Details</label>
        <input id="pm_birth_date" class="input" placeholder="Birth Date (e.g., 1 Jan 1900)"/>
        <input id="pm_birth_place" class="input" placeholder="Birth Place / Location"/>
    </div>
    <div class="row" style="margin-top:10px">
        <label style="width:100%;font-size:0.8em;opacity:0.8;margin-bottom: -10px;">Death Details</label>
        <input id="pm_death_date" class="input" placeholder="Death Date (optional)"/>
        <input id="pm_death_place" class="input" placeholder="Death Place (optional)"/>
    </div>
    <div class="row" style="margin-top:10px">
        <label style="width:100%;font-size:0.8em;opacity:0.8;margin-bottom: -10px;">Marriage Details</label>
        <input id="pm_marriage_date" class="input" placeholder="Marriage Date (optional)"/>
        <input id="pm_marriage_place" class="input" placeholder="Marriage Place (optional)"/>
    </div>

    <div class="cta">
      <button id="pm_add" class="button">Add Person to Firestore</button>
      <label class="button" for="pm_import_file" style="cursor:pointer">Import People Data (JSON)</label>
      <input id="pm_import_file" type="file" accept=".json,application/json" style="display:none"/>
      <button id="pm_clear" class="button">Clear Local Fields</button>
    </div>
    <div class="small">Note: All live data management requires a custom component with Firebase. The previous import/export/commit features for people.json are no longer supported in this mode.</div>
    <div id="pm_table_wrap" class="container" style="padding:0">
      <table id="pm_table" style="width:100%;border-collapse:collapse;margin-top:12px">
        <thead>
          <tr>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Name / ID</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Birth (Date/Place)</th>
            <th style="text-align
