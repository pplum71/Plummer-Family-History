<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin · Plummer Family History</title>
  <meta name="description" content="A multipage family history site for preserving stories, photos, and the family tree." />
  <link rel="stylesheet" href="./assets/style.css" />
</head>
<body>
  
    <nav class="nav">
      <div class="nav-inner nav">
        <div class="brand">
          <img src="./assets/logo.png" alt="Plummer Crest" style="height:28px;width:auto" />
          <span>Plummer Family History</span>
        </div>
        <ul class="nav">
          <li><a href="index.html" >Home</a></li>
          <li><a href="family-tree.html" >Family Tree</a></li>
          <li><a href="stories.html" >Stories</a></li>
          <li><a href="photos.html" >Photos</a></li>
          <li><a href="contact.html" >Contact</a></li>
          <!-- Admin is intentionally not linked in nav -->
        </ul>
      </div>
    </nav>
    
  
<main class="container">
  <h1>Admin</h1>
  <div id="admin-locked" class="alert hidden">This page is locked. Append <code>?key=YOURSECRET</code> to the URL (replace with your secret).</div>
  <div id="admin-content">
    <p>Maintain site data by editing the JSON files in <code>/data</code>:</p>
    <ul>
      <li><code>data/people.json</code> — list of people (name, birthYear, location, summary)</li>
      <li><code>data/stories.json</code> — list of stories (title, year, author, summary, content)</li>
      <li><code>data/photos.json</code> — gallery image sources</li>
    </ul>
    <p class="small">For privacy, do not include sensitive information about living relatives on the public site.</p>
    <hr/>
    <h3>Hide “People” from public nav</h3>
    <p>If you want the People page hidden publicly, remove it from <code>nav</code> links, but keep the file—editors can open it directly.</p>
    <hr/>
    
    <hr/>
    <h3 id="tree-embed">Interactive Tree Embed</h3>
    <p class="small">Edit the HTML shown on the Family Tree page under “Interactive Tree (Embed)”. You can paste D3 scripts, an SVG, or an <code>&lt;iframe&gt;</code> to another viewer. When done, click Commit to GitHub to publish <code>data/tree-embed.html</code>.</p>
    <textarea id="te_editor" class="input" rows="10" placeholder="Paste your embed HTML here"></textarea>
    <div class="cta">
      <button id="te_load" class="button">Load current embed</button>
      <button id="te_save_local" class="button">Save draft (local)</button>
      <button id="te_commit" class="button">Commit tree-embed.html to GitHub</button>
      <button id="te_reset" class="button">Reset to placeholder</button>
    </div>
    <script>
      const TE_KEY = 'treeEmbedDraft';
      function te_save(){ localStorage.setItem(TE_KEY, document.getElementById('te_editor').value); }
      function te_loadLocal(){ return localStorage.getItem(TE_KEY) || ''; }
      async function te_loadRemote(){
        const t = await fetch('./data/tree-embed.html', {cache:'no-store'}).then(r=> r.ok ? r.text() : '');
        document.getElementById('te_editor').value = t;
      }
      document.getElementById('te_load').addEventListener('click', te_loadRemote);
      document.getElementById('te_save_local').addEventListener('click', ()=>{ te_save(); alert('Draft saved in this browser.'); });
      document.getElementById('te_reset').addEventListener('click', ()=>{
        document.getElementById('te_editor').value = '<div class="figure">Add your interactive tree here (D3, SVG, or an embedded viewer).</div>';
      });
      document.getElementById('te_commit').addEventListener('click', async ()=>{
        const cfg = (typeof gh_cfgFromInputs === 'function') ? gh_cfgFromInputs() : null;
        if(!cfg || !cfg.owner || !cfg.repo){ alert('Fill in GitHub Settings first'); return; }
        const html = document.getElementById('te_editor').value;
        // encode HTML as UTF-8 base64
        const enc = new TextEncoder().encode(html);
        let bin = ''; for (let i=0;i<enc.length;i++) bin += String.fromCharCode(enc[i]);
        const b64 = btoa(bin);
        try{
          if(typeof nf_commitFile === 'function'){
            await nf_commitFile(cfg, 'data/tree-embed.html', b64, 'Update tree-embed.html via Admin');
          }else if(typeof gh_commitFile === 'function'){
            await gh_commitFile(cfg, 'data/tree-embed.html', b64, 'Update tree-embed.html via Admin');
          } else {
            throw new Error('No commit function available');
          }
          alert('Committed tree-embed.html');
        }catch(e){ alert(e.message); }
      });
      // Prefill with local draft or remote on first load
      window.addEventListener('DOMContentLoaded', async ()=>{
        const draft = te_loadLocal();
        if(draft){ document.getElementById('te_editor').value = draft; }
        else { try{ await te_loadRemote(); }catch(_){} }
      });
    
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>
    

    <hr/>
    <h3 id="first-run">First‑Run Setup</h3>
    <p class="small">Quickly create starter data files if they’re missing, then publish them to your GitHub repo.</p>
    <div class="cta">
      <button id="fr_check" class="button">Check data files</button>
      <button id="fr_make_stories" class="button">Create starter stories.json</button>
      <button id="fr_make_photos" class="button">Create starter photos.json</button>
      <button id="fr_commit_stories" class="button">Commit stories.json</button>
      <button id="fr_commit_photos" class="button">Commit photos.json</button>
    </div>
    <div id="fr_status" class="small"></div>
    <script>
      const FR_STORIES = [
        { "title": "How Our Family Got Started", "year": "1900", "author": "Family Archive", "summary": "A short origin story.", "content": "Write your story here…" }
      ];
      const FR_PHOTOS = [
        { "src": "https://images.unsplash.com/photo-1519681393784-d120267933ba", "alt": "Family album" }
      ];
      async function fr_exists(path){
        try{ const r = await fetch(path, {cache:'no-store'}); return r.ok; }catch(_){ return false; }
      }
      function fr_msg(t){ document.getElementById('fr_status').innerHTML = t; }
      function toB64(str){
        const enc = new TextEncoder().encode(str);
        let bin=''; for(let i=0;i<enc.length;i++) bin += String.fromCharCode(enc[i]);
        return btoa(bin);
      }
      async function fr_commit_json(path, objArr){
        const cfg = (typeof gh_cfgFromInputs==='function') ? gh_cfgFromInputs() : null;
        if(!cfg || !cfg.owner || !cfg.repo){ alert('Fill in GitHub Settings first'); return; }
        const b64 = toB64(JSON.stringify(objArr, null, 2));
        if(typeof nf_commitFile === 'function'){
          await nf_commitFile(cfg, path, b64, 'Create ' + path + ' via First-Run');
        } else if(typeof gh_commitFile === 'function') {
          await gh_commitFile(cfg, path, b64, 'Create ' + path + ' via First-Run');
        } else { throw new Error('No commit function available'); }
      }
      document.getElementById('fr_check').addEventListener('click', async ()=>{
        const s = await fr_exists('./data/stories.json');
        const p = await fr_exists('./data/photos.json');
        fr_msg(`<div class="alert">stories.json: ${s ? 'present' : 'missing'} • photos.json: ${p ? 'present' : 'missing'}</div>`);
      });
      document.getElementById('fr_make_stories').addEventListener('click', ()=>{
        localStorage.setItem('storiesManagerDraft', JSON.stringify(FR_STORIES));
        alert('Starter stories loaded into Stories Manager draft. Review and Commit.');
        location.hash = '#stories-manager';
      });
      document.getElementById('fr_make_photos').addEventListener('click', ()=>{
        localStorage.setItem('photosManagerDraft', JSON.stringify(FR_PHOTOS));
        alert('Starter photos loaded into Photos Manager draft. Review and Commit.');
        location.hash = '#photos-manager';
      });
      document.getElementById('fr_commit_stories').addEventListener('click', async ()=>{
        try{
          const draft = JSON.parse(localStorage.getItem('storiesManagerDraft') || '[]');
          await fr_commit_json('data/stories.json', draft.length ? draft : FR_STORIES);
          alert('Committed stories.json');
        }catch(e){ alert(e.message); }
      });
      document.getElementById('fr_commit_photos').addEventListener('click', async ()=>{
        try{
          const draft = JSON.parse(localStorage.getItem('photosManagerDraft') || '[]');
          await fr_commit_json('data/photos.json', draft.length ? draft : FR_PHOTOS);
          alert('Committed photos.json');
        }catch(e){ alert(e.message); }
      });
    
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>
<h3>Deployment</h3>
    <p>Use GitHub Pages or Netlify to host. See <a href="./README.html">README</a> for step‑by‑step.</p>
  
    <hr/>
    <h3 id="people-manager">People Manager</h3><p class="small">IDs must be unique (e.g., <code>john-gordon-plummer-1890</code>). Parents: comma-separated IDs.</p><p class="small"><a class="button" href="./people.html" target="_blank" rel="noreferrer">Open public People page</a></p>
    <p class="small">Quickly add or edit relatives. Changes stay in your browser until you click <strong>Export people.json</strong>.</p>
    <div class="searchbar">
      <input id="pm_name" class="input" placeholder="Full name (required)"/>
      <input id="pm_birth" class="input" placeholder="Birth year (e.g., 1942)"/>
    </div>
    <div class="row">
      <input id="pm_id" class="input" placeholder="ID (auto from name+year if blank)"/>
      <input id="pm_parents" class="input" placeholder="Parents (IDs, comma-separated)"/>
    </div>
    <div class="row">
      <input id="pm_location" class="input" placeholder="Birthplace / Location"/>
      <input id="pm_summary" class="input" placeholder="One-line note (e.g., 'Teacher, loved music')"/>
    </div>
    <div class="cta">
      <button id="pm_add" class="button">Add to List</button>
      <label class="button" for="pm_import_file" style="cursor:pointer">Import people.json</label>
      <input id="pm_import_file" type="file" accept=".json,application/json" style="display:none"/>
      <button id="pm_export" class="button">Export people.json</button>
      <button id="pm_commit" class="button">Commit people.json to GitHub</button>
      <button id="pm_clear" class="button">Clear List</button>
    </div>
    <div class="small">Tip: After exporting, replace <code>/data/people.json</code> in your repo or Netlify deploy.</div>
    <div id="pm_table_wrap" class="container" style="padding:0">
      <table id="pm_table" style="width:100%;border-collapse:collapse;margin-top:12px">
        <thead>
          <tr>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">ID</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Name</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Birth Year</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Parents (IDs)</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Location</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Summary</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Actions</th>
          </tr>
        </thead>
        <tbody id="pm_body"></tbody>
      </table>
    </div>
    <script>
      // People Manager logic
      const PM_KEY = 'peopleManagerDraft';
      const pmState = { list: [] };

      function pm_saveLocal(){
        localStorage.setItem(PM_KEY, JSON.stringify(pmState.list));
      }
      function pm_loadLocal(){
        try { pmState.list = JSON.parse(localStorage.getItem(PM_KEY)) || []; } catch(_){ pmState.list = []; }
      }
      function pm_render(){
        const body = document.getElementById('pm_body');
        body.innerHTML = pmState.list.map((p, i) => `
          <tr>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${p.name||''}" data-i="${i}" data-k="name"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${p.birthYear||''}" data-i="${i}" data-k="birthYear"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${p.location||''}" data-i="${i}" data-k="location"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${p.summary||''}" data-i="${i}" data-k="summary"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)">
              <button class="button" data-del="${i}">Delete</button>
            </td>
          </tr>
        `).join('');
        body.querySelectorAll('input').forEach(inp => {
          inp.addEventListener('input', (e)=>{
            const i = +e.target.dataset.i, k = e.target.dataset.k;
            if(k==='parents'){ pmState.list[i][k] = e.target.value.split(',').map(s=>s.trim()).filter(Boolean); }
            else { pmState.list[i][k] = e.target.value; }
            pm_saveLocal();
          });
        });
        body.querySelectorAll('[data-del]').forEach(btn => {
          btn.addEventListener('click', (e)=>{
            const i = +e.target.dataset.del;
            pmState.list.splice(i,1);
            pm_saveLocal(); pm_render();
          });
        });
      }

      async function pm_loadInitial(){
        // Try local first; if empty, load data/people.json to seed
        pm_loadLocal();
        if(pmState.list.length === 0){
          try {
            const res = await fetch('./data/people.json', {cache:'no-store'});
            if(res.ok){ pmState.list = await res.json(); pm_saveLocal(); }
          } catch(_) {}
        }
        pm_render();
      }

      function pm_download(filename, text){
        const blob = new Blob([text], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
      }

      document.getElementById('pm_add').addEventListener('click', ()=>{
        const name = document.getElementById('pm_name').value.trim();
        if(!name){ alert('Name is required'); return; }
        const birth = document.getElementById('pm_birth').value.trim();
        const idIn = document.getElementById('pm_id').value.trim();
        const parentsIn = document.getElementById('pm_parents').value.trim();
        const loc = document.getElementById('pm_location').value.trim();
        const sum = document.getElementById('pm_summary').value.trim();
        const genId = (name + '-' + birth).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
        const id = idIn || genId;
        const parents = parentsIn ? parentsIn.split(',').map(s=>s.trim()).filter(Boolean) : [];
        pmState.list.unshift({id, name, birthYear: birth, parents, location: loc, summary: sum, spouses: ([]) });
        document.getElementById('pm_name').value = '';
        document.getElementById('pm_birth').value = '';
        document.getElementById('pm_id').value = '';
        document.getElementById('pm_parents').value = '';
        document.getElementById('pm_location').value = '';
        document.getElementById('pm_summary').value = '';
        pm_saveLocal(); pm_render();
      });

      document.getElementById('pm_export').addEventListener('click', ()=>{
        pm_download('people.json', JSON.stringify(pmState.list, null, 2));
      });

      document.getElementById('pm_import_file').addEventListener('change', async (e)=>{
        const file = e.target.files[0];
        if(!file) return;
        const text = await file.text();
        try{
          const arr = JSON.parse(text);
          if(Array.isArray(arr)){
            pmState.list = arr;
            pm_saveLocal(); pm_render();
          } else { alert('Invalid JSON format: expected an array'); }
        }catch(err){
          alert('Could not parse JSON file.');
        }
      });

      document.getElementById('pm_clear').addEventListener('click', ()=>{
        if(confirm('Clear the working list? This only clears the local draft in this browser.')){
          pmState.list = []; pm_saveLocal(); pm_render();
        }
      });

      pm_loadInitial();
    
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

    <hr/>
    <h3 id="stories-manager">Stories Manager</h3>
    <p class="small">Write short family histories and recipes. Export to update <code>data/stories.json</code>.</p>
    <div class="row">
      <input id="sm_title" class="input" placeholder="Title (required)"/>
      <input id="sm_year" class="input" placeholder="Year (e.g., 1975)"/>
    </div>
    <div class="row">
      <input id="sm_author" class="input" placeholder="Author"/>
      <input id="sm_summary" class="input" placeholder="One-line summary"/>
    </div>
    <label class="label">Content</label>
    <textarea id="sm_content" class="input" rows="6" placeholder="Full story text"></textarea>
    <div class="cta">
      <button id="sm_add" class="button">Add Story</button>
      <label class="button" for="sm_import_file" style="cursor:pointer">Import stories.json</label>
      <input id="sm_import_file" type="file" accept=".json,application/json" style="display:none"/>
      <button id="sm_export" class="button">Export stories.json</button>
      <button id="sm_commit" class="button">Commit stories.json to GitHub</button>
      <button id="sm_clear" class="button">Clear List</button>
    </div>
    <div id="sm_table_wrap" class="container" style="padding:0">
      <table id="sm_table" style="width:100%;border-collapse:collapse;margin-top:12px">
        <thead>
          <tr>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Title</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Year</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Author</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Summary</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Content</th>
            <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.12);padding:8px">Actions</th>
          </tr>
        </thead>
        <tbody id="sm_body"></tbody>
      </table>
    </div>
    <script>
      const SM_KEY = 'storiesManagerDraft';
      const smState = { list: [] };

      function sm_save(){ localStorage.setItem(SM_KEY, JSON.stringify(smState.list)); }
      function sm_load(){ try{ smState.list = JSON.parse(localStorage.getItem(SM_KEY)) || []; }catch(_){ smState.list=[]; } }
      function sm_render(){
        const body = document.getElementById('sm_body');
        body.innerHTML = smState.list.map((s,i)=>`
          <tr>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${s.title||''}" data-i="${i}" data-k="title"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${s.year||''}" data-i="${i}" data-k="year"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${s.author||''}" data-i="${i}" data-k="author"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><input class="input" value="${s.summary||''}" data-i="${i}" data-k="summary"/></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><textarea class="input" rows="4" data-i="${i}" data-k="content">${s.content or ''}</textarea></td>
            <td style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)"><button class="button" data-sm-del="${i}">Delete</button></td>
          </tr>
        `).join('');
        body.querySelectorAll('input,textarea').forEach(el=>{
          el.addEventListener('input', e=>{
            const i = +e.target.dataset.i, k = e.target.dataset.k;
            smState.list[i][k] = e.target.value; sm_save();
          });
        });
        body.querySelectorAll('[data-sm-del]').forEach(btn=>{
          btn.addEventListener('click', e=>{
            const i = +e.target.dataset['smDel'];
            smState.list.splice(i,1); sm_save(); sm_render();
          });
        });
      }
      async function sm_boot(){
        sm_load();
        if(smState.list.length===0){
          try{ const r=await fetch('./data/stories.json',{cache:'no-store'}); if(r.ok){ smState.list=await r.json(); sm_save(); } }catch(_){}
        }
        sm_render();
      }
      function sm_download(name,text){
        const blob = new Blob([text], {type:'application/json'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href);
      }
      document.getElementById('sm_add').addEventListener('click',()=>{
        const t=$('#sm_title').value.trim(); if(!t){ alert('Title required'); return; }
        const y=$('#sm_year').value.trim(), a=$('#sm_author').value.trim(), s=$('#sm_summary').value.trim(), c=$('#sm_content').value;
        smState.list.unshift({title:t, year:y, author:a, summary:s, content:c});
        ['sm_title','sm_year','sm_author','sm_summary','sm_content'].forEach(id=>document.getElementById(id).value='');
        sm_save(); sm_render();
      });
      document.getElementById('sm_export').addEventListener('click',()=> sm_download('stories.json', JSON.stringify(smState.list,null,2)));
      document.getElementById('sm_import_file').addEventListener('change', async (e)=>{
        const f=e.target.files[0]; if(!f) return; const txt=await f.text();
        try{ const arr=JSON.parse(txt); if(Array.isArray(arr)){ smState.list=arr; sm_save(); sm_render(); } else alert('Invalid JSON (expected array)'); }catch(_){ alert('Could not parse JSON'); }
      });
      document.getElementById('sm_clear').addEventListener('click',()=>{ if(confirm('Clear draft stories?')){ smState.list=[]; sm_save(); sm_render(); } });
      sm_boot();
    
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

    <hr/>
    <h3 id="photos-manager">Photos Manager</h3>
    <p class="small">Add photo URLs (from your repo, Google Photos share links with direct image, or any CDN). Export to update <code>data/photos.json</code>.</p>
    <div class="row">
      <input id="pm2_src" class="input" placeholder="Image URL (required)"/>
      <input id="pm2_alt" class="input" placeholder="Alt text / caption"/>
    </div>
    <div class="cta">
      <button id="pm2_add" class="button">Add Photo</button>
      <input id="pm2_files" type="file" multiple accept="image/*" style="display:none"/>
      <label class="button" for="pm2_files" style="cursor:pointer">Choose Images</label>
      <button id="pm2_upload" class="button">Upload to GitHub & Add</button>
      <label class="button" for="pm2_import_file" style="cursor:pointer">Import photos.json</label>
      <input id="pm2_import_file" type="file" accept=".json,application/json" style="display:none"/>
      <button id="pm2_export" class="button">Export photos.json</button>
      <button id="pm2_commit" class="button">Commit photos.json to GitHub</button>
      <button id="pm2_clear" class="button">Clear List</button>
    </div>
    <div id="pm2_preview" class="gallery" style="margin-top:10px"></div>
    <div id="pm2_progress" class="small"></div>
    <div id="pm2_grid" class="gallery"></div>
    <script>
      const PM2_KEY = 'photosManagerDraft';
      const pm2State = { list: [] };
      function pm2_save(){ localStorage.setItem(PM2_KEY, JSON.stringify(pm2State.list)); }
      function pm2_load(){ try{ pm2State.list = JSON.parse(localStorage.getItem(PM2_KEY)) || []; }catch(_){ pm2State.list=[]; } }
      function pm2_render(){
        const grid = document.getElementById('pm2_grid');
        grid.innerHTML = pm2State.list.map((p,i)=>`
          <div style="position:relative">
            <img src="${p.src}" alt="${p.alt||''}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/>
            <div class="small" style="margin-top:4px">${p.alt||''}</div>
            <button class="button" data-pm2-del="${i}" style="position:absolute;top:6px;right:6px">✕</button>
          </div>
        `).join('');
        grid.querySelectorAll('[data-pm2-del]').forEach(btn=>{
          btn.addEventListener('click', e=>{
            const i = +e.target.dataset.pm2Del;
            pm2State.list.splice(i,1); pm2_save(); pm2_render();
          });
        });
      }
      async function pm2_boot(){
        pm2_load();
        if(pm2State.list.length===0){
          try{ const r=await fetch('./data/photos.json',{cache:'no-store'}); if(r.ok){ pm2State.list = await r.json(); pm2_save(); } }catch(_){}
        }
        pm2_render();
      }
      function pm2_download(name,text){
        const blob = new Blob([text], {type:'application/json'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href);
      }
      document.getElementById('pm2_add').addEventListener('click', ()=>{
        const src = document.getElementById('pm2_src').value.trim(); if(!src){ alert('Image URL required'); return; }
        const alt = document.getElementById('pm2_alt').value.trim();
        pm2State.list.unshift({src, alt}); document.getElementById('pm2_src').value=''; document.getElementById('pm2_alt').value='';
        pm2_save(); pm2_render();
      });
      document.getElementById('pm2_export').addEventListener('click', ()=> pm2_download('photos.json', JSON.stringify(pm2State.list,null,2)));
      document.getElementById('pm2_import_file').addEventListener('change', async (e)=>{
        const f=e.target.files[0]; if(!f) return; const txt=await f.text();
        try{ const arr=JSON.parse(txt); if(Array.isArray(arr)){ pm2State.list=arr; pm2_save(); pm2_render(); } else alert('Invalid JSON (expected array)'); }catch(_){ alert('Could not parse JSON'); }
      });
      document.getElementById('pm2_clear').addEventListener('click', ()=>{ if(confirm('Clear draft photos?')){ pm2State.list=[]; pm2_save(); pm2_render(); } });
      pm2_boot();
    
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>


</div>
</main>
<script>adminGate("YOURSECRET")
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

<script>
  // ---- GitHub client-side commits (use fine-grained token!) ----
  const GH_KEY = 'familySiteGithubSettings';
  function gh_get(){
    try{ return JSON.parse(localStorage.getItem(GH_KEY)) || {}; }catch(_){ return {}; }
  }
  function gh_set(cfg){
    localStorage.setItem(GH_KEY, JSON.stringify(cfg));
  }
  function gh_cfgFromInputs(){
    return {
      owner: document.getElementById('gh_owner').value.trim(),
      repo: document.getElementById('gh_repo').value.trim(),
      branch: document.getElementById('gh_branch').value.trim() || 'main',
      images_path: document.getElementById('gh_images_path').value.trim() || 'assets/photos',
      token: document.getElementById('gh_token').value.trim()
    };
  }
  function gh_fillInputs(cfg){
    if(!cfg) return;
    document.getElementById('gh_owner').value = cfg.owner || '';
    document.getElementById('gh_repo').value = cfg.repo || '';
    document.getElementById('gh_branch').value = cfg.branch || 'main';
    document.getElementById('gh_images_path').value = cfg.images_path || 'assets/photos';
    document.getElementById('gh_token').value = cfg.token || '';
  }
  function gh_init(){
    gh_fillInputs(gh_get());
    document.getElementById('gh_save').addEventListener('click', ()=>{
      gh_set(gh_cfgFromInputs());
      alert('Saved locally.');
    });
    document.getElementById('gh_clear').addEventListener('click', ()=>{
      localStorage.removeItem(GH_KEY); gh_fillInputs({});
    });
  }
  function gh_headers(token){
    return { 
      'Accept':'application/vnd.github+json',
      'Authorization': 'Bearer ' + token,
      'X-GitHub-Api-Version': '2022-11-28',
      'Content-Type': 'application/json'
    };
  }
  async function gh_getFileSha(cfg, path){
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(cfg.branch)}`;
    const r = await fetch(url, { headers: gh_headers(cfg.token) });
    if(r.status === 200){ const j = await r.json(); return j.sha; }
    return null; // not found means create
  }
  async function gh_commitFile(cfg, path, contentBase64, message){
    const sha = await gh_getFileSha(cfg, path);
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(path)}`;
    const body = { message, content: contentBase64, branch: cfg.branch };
    if(sha) body.sha = sha;
    const r = await fetch(url, { method:'PUT', headers: gh_headers(cfg.token), body: JSON.stringify(body) });
    if(!r.ok){ const t = await r.text(); throw new Error('GitHub commit failed: ' + t); }
    return r.json();
  }
  function toBase64(arrayBuffer){
    let binary = '';
    const bytes = new Uint8Array(arrayBuffer);
    const len = bytes.byteLength;
    for(let i=0; i<len; i++){ binary += String.fromCharCode(bytes[i]); }
    return btoa(binary);
  }
  function gh_rawUrl(cfg, path){
    return `https://raw.githubusercontent.com/${cfg.owner}/${cfg.repo}/${cfg.branch}/${path}`;
  }

  // Hook GitHub init after page load
  window.addEventListener('DOMContentLoaded', gh_init);

<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

<script>
  async function pm_commit_json(){
    const cfg = gh_cfgFromInputs(); if(!cfg.owner||!cfg.repo||!cfg.token){ alert('Set GitHub settings first'); return; }
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(pmState.list, null, 2))));
    try{ await gh_commitFile(cfg, 'data/people.json', content, 'Update people.json via Admin'); alert('Committed people.json'); }
    catch(e){ alert(e.message); }
  }
  async function sm_commit_json(){
    const cfg = gh_cfgFromInputs(); if(!cfg.owner||!cfg.repo||!cfg.token){ alert('Set GitHub settings first'); return; }
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(smState.list, null, 2))));
    try{ await gh_commitFile(cfg, 'data/stories.json', content, 'Update stories.json via Admin'); alert('Committed stories.json'); }
    catch(e){ alert(e.message); }
  }
  async function pm2_commit_json(){
    const cfg = gh_cfgFromInputs(); if(!cfg.owner||!cfg.repo||!cfg.token){ alert('Set GitHub settings first'); return; }
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(pm2State.list, null, 2))));
    try{ await gh_commitFile(cfg, 'data/photos.json', content, 'Update photos.json via Admin'); alert('Committed photos.json'); }
    catch(e){ alert(e.message); }
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs(); if(!cfg.owner||!cfg.repo||!cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    if(!input.files.length){ alert('Choose images first'); return; }
    for(const file of input.files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        // add to photos list
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    pm2_save(); pm2_render();
    alert('Upload(s) done. Remember to Commit photos.json to GitHub to publish the updated gallery.');
  }
  // Wire buttons after DOM loaded (People/Stories/Photos managers exist)
  window.addEventListener('DOMContentLoaded', ()=>{
    const b1 = document.getElementById('pm_commit'); if(b1) b1.addEventListener('click', pm_commit_json);
    const b2 = document.getElementById('sm_commit'); if(b2) b2.addEventListener('click', sm_commit_json);
    const b3 = document.getElementById('pm2_commit'); if(b3) b3.addEventListener('click', pm2_commit_json);
    const b4 = document.getElementById('pm2_upload'); if(b4) b4.addEventListener('click', pm2_upload_files);
  });

<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>


  <footer>
    © <span id="y"></span> Plummer Family — Built with care. | <span class="small">Admin: open <code>/admin.html?key=YOURSECRET</code></span>
  </footer>
  <script src="./assets/script.js">
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>
  <script>document.getElementById('y').textContent=new Date().getFullYear()
<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

<script>
  // Prefill defaults for Patrick's repo if nothing is saved yet
  window.addEventListener('DOMContentLoaded', () => {
    try {
      const GH_KEY = 'familySiteGithubSettings';
      const existing = JSON.parse(localStorage.getItem(GH_KEY) || 'null');
      if (!existing) {
        const defaults = {
          owner: 'pplum71',
          repo: 'Plummer-Family-History',
          branch: 'main',
          images_path: 'assets/photos',
          token: ''
        };
        // Fill inputs for convenience (does not store until "Save Settings")
        document.getElementById('gh_owner').value = defaults.owner;
        document.getElementById('gh_repo').value = defaults.repo;
        document.getElementById('gh_branch').value = defaults.branch;
        document.getElementById('gh_images_path').value = defaults.images_path;
        // token purposely left blank
      }
    } catch (e) {}
  });

<script>
  function pm2_handle_file_select(e){
    const grid = document.getElementById('pm2_preview');
    grid.innerHTML = '';
    const files = Array.from(e.target.files || []);
    if (!files.length){ grid.innerHTML = '<div class="small">No files selected yet.</div>'; return; }
    grid.innerHTML = files.map(f => {
      const url = URL.createObjectURL(f);
      const name = f.name.replace(/\.[^.]+$/, '');
      return `<div><img src="${url}" alt="${name}" style="width:100%;height:150px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08)"/><div class="small">${f.name}</div></div>`;
    }).join('');
  }
  async function pm2_upload_files(){
    const cfg = gh_cfgFromInputs ? gh_cfgFromInputs() : null;
    if(!cfg || !cfg.owner || !cfg.repo || !cfg.token){ alert('Set GitHub settings first'); return; }
    const input = document.getElementById('pm2_files');
    const files = Array.from(input.files || []);
    if(!files.length){ alert('Choose images first'); return; }
    const prog = document.getElementById('pm2_progress');
    let done = 0;
    prog.textContent = `Uploading 0/${files.length}…`;
    for(const file of files){
      const buf = await file.arrayBuffer();
      const b64 = toBase64(buf);
      const path = `${cfg.images_path.replace(/\/$/,'')}/${file.name}`;
      try{
        await gh_commitFile(cfg, path, b64, `Add photo ${file.name} via Admin`);
        const url = gh_rawUrl(cfg, path);
        pm2State.list.unshift({src: url, alt: file.name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')});
        done++;
        prog.textContent = `Uploading ${done}/${files.length}…`;
      }catch(e){
        alert('Upload failed for ' + file.name + ': ' + e.message);
      }
    }
    prog.textContent = `Done: ${done}/${files.length} uploaded. Now "Commit photos.json" to publish the gallery.`;
    pm2_save(); pm2_render();
  }
</script>
</script>

</body>
</html>